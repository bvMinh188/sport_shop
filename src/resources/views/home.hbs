{{!-- <div class="hero-image">
    <a href="href="/products/giay-da-bong-jogarbola-racer-jg-2223""></a>
        <img src="https://theme.hstatic.net/1000288768/1000753028/14/home_slider_image_4.jpg?v=4353" alt="Banner Image" class="img-fluid">
    </a>
</div> --}}


<!-- Main Products Section -->
<div class="container mt-4" id="products">
    <h2 class="text-center mb-4">GIÀY THỂ THAO</h2>

    <!-- Nút lọc danh mục -->
    <div class="text-center mb-4">
        <a href="?" class="btn btn-outline-success {{#unless selectedCategory}}active{{/unless}}">
            Tất Cả
        </a>
        {{#each categories}}
            <a href="#" class="btn btn-outline-success category-filter {{#if (eq this ../selectedCategory)}}active{{/if}}" data-category="{{this}}">
                {{this}}
            </a>
        {{/each}}
    </div>

    <!-- Nút lọc theo giá -->
    <div class="btn-group mb-4">
        <button type="button" id="filterButton" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            Lọc
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a href="#" class="dropdown-item price-filter" data-sort="asc">Giá tăng dần</a></li>
            <li><a href="#" class="dropdown-item price-filter" data-sort="desc">Giá giảm dần</a></li>
        </ul>
    </div>

    <!-- Product Grid -->
    <div class="row">
        {{#each products}}
        <div class="col-md-3 mb-4">
            <div class="product-card position-relative">
                <!-- Tags -->
                <div class="product-tags">
                    {{#if this.discount}}
                        <span class="discount-tag">-{{this.discount}}%</span>
                    {{/if}}
                    {{#ifGreaterOrEqual this.sold 10}}
                        <span class="status-tag">Bán chạy nhất</span>
                    {{/ifGreaterOrEqual}}
                </div>
                
                <!-- Product Image -->
                <a href="/products/{{this.slug}}" class="product-link">
                    <div class="product-image-container">
                        <img src="{{this.image}}" alt="{{this.name}}" class="product-image">
                    </div>
                </a>

                <!-- Product Info -->
                <div class="product-info">
                    <h5 class="product-title">{{this.name}}</h5>
                    <div class="product-price">
                        <span class="current-price">{{formatPrince this.price}}</span>
                        {{#if this.originalPrice}}
                            <span class="original-price">{{formatPrince this.originalPrice}}</span>
                        {{/if}}
                    </div>
                    <div class="sold-count">
                        Đã bán: {{this.sold}}
                    </div>
                </div>
            </div>
        </div>
        {{/each}}
    </div>

    <!-- Pagination -->
    <div class="pagination-container text-center mt-4">
        <ul class="pagination">
            {{#if (gt currentPage 1)}}
                <li class="page-item">
                    <a class="page-link pagination-link" data-page="{{subtract currentPage 1}}">❮</a>
                </li>
            {{/if}}

            {{#each (range 1 totalPages)}}
                <li class="page-item {{#if (eq this ../currentPage)}}active{{/if}}">
                    <a class="page-link pagination-link" data-page="{{this}}">{{this}}</a>
                </li>
            {{/each}}

            {{#if (lt currentPage totalPages)}}
                <li class="page-item">
                    <a class="page-link pagination-link" data-page="{{sum currentPage 1}}">❯</a>
                </li>
            {{/if}}
        </ul>
    </div>
</div>

<style>
.hero-section {
    background-color: #f8f9fa;
    min-height: 100vh;
    display: flex;
    align-items: center;
}

.hero-content {
    padding: 2rem;
}

.hero-text span {
    font-size: 1.2rem;
}

.stats h3 {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 0;
}

.stats p {
    color: #6c757d;
    margin-bottom: 0;
}

.product-slider-section {
    height: 100vh;
    display: flex;
    align-items: center;
    background-color: #fff;
}

.swiper-container {
    width: 100%;
    height: 80%;
}

.featured-product {
    padding: 2rem;
}

.featured-image {
    max-height: 400px;
    object-fit: contain;
    transition: transform 0.3s ease;
}

.featured-product:hover .featured-image {
    transform: scale(1.05);
}

.product-info {
    padding: 1rem;
}

.swiper-button-next,
.swiper-button-prev {
    color: #dc3545;
}

.swiper-button-next:after,
.swiper-button-prev:after {
    font-size: 24px;
}

@media (max-width: 768px) {
    .hero-section {
        min-height: auto;
    }
    
    .product-slider-section {
        height: auto;
        min-height: 60vh;
    }
}

.product-card {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.product-tags {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 2;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.discount-tag {
    background: #ff0000;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 14px;
}

.status-tag {
    background: #ff0000;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 14px;
}

.product-image-container {
    position: relative;
    padding-top: 100%;
    background: #f8f9fa;
}

.product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 20px;
}

.product-info {
    padding: 15px;
}

.product-title {
    font-size: 14px;
    margin-bottom: 10px;
    height: 40px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.product-price {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 5px;
}

.current-price {
    color: #ff0000;
    font-weight: bold;
    font-size: 16px;
}

.original-price {
    color: #999;
    text-decoration: line-through;
    font-size: 14px;
}

.sold-count {
    font-size: 13px;
    color: #666;
}

.product-link {
    text-decoration: none;
    color: inherit;
}
</style>

<script src="https://unpkg.com/swiper/swiper-bundle.min.css"></script>
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script>
    // Initialize Swiper
    var swiper = new Swiper('.swiper-container', {
        slidesPerView: 1,
        spaceBetween: 30,
        loop: true,
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        effect: 'fade',
        fadeEffect: {
            crossFade: true
        },
        autoplay: {
            delay: 3000,
            disableOnInteraction: false,
        }
    });

    function updateURL(param, value) {
        let url = new URL(window.location.href);
        if (value) {
            url.searchParams.set(param, value);
            // Reset page to 1 when changing category
            if (param === 'category') {
                url.searchParams.set('page', '1');
            }
        } else {
            url.searchParams.delete(param);
            if (param === 'category') {
                url.searchParams.set('page', '1');
            }
        }
        window.location.href = url.toString();
    }

    // Bắt sự kiện lọc theo danh mục
    document.querySelectorAll(".category-filter").forEach(button => {
        button.addEventListener("click", function (e) {
            e.preventDefault();
            updateURL("category", this.dataset.category);
        });
    });

    // Bắt sự kiện lọc theo giá
    document.querySelectorAll(".price-filter").forEach(button => {
        button.addEventListener("click", function (e) {
            e.preventDefault();
            updateURL("_sort", this.dataset.sort);
        });
    });

    // Bắt sự kiện phân trang
    document.querySelectorAll(".pagination-link").forEach(link => {
        link.addEventListener("click", function (e) {
            e.preventDefault();
            updateURL("page", this.dataset.page);
        });
    });

    // Cập nhật nội dung nút lọc theo giá khi trang tải lại
    function updateFilterButtonText() {
        const urlParams = new URLSearchParams(window.location.search);
        const sortValue = urlParams.get('_sort');
        const button = document.getElementById("filterButton");

        if (sortValue === 'asc') {
            button.textContent = "Giá tăng dần";
        } else if (sortValue === 'desc') {
            button.textContent = "Giá giảm dần";
        } else {
            button.textContent = "Lọc";
        }
    }

    updateFilterButtonText();
</script>

